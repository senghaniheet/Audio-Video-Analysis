<div class="container">
  <div class="header">
    <h1>AI-Based Eliant Order Status Voice Assistant</h1>
    <p class="subtitle">Upload audio/video or record live voice to check your order status</p>
  </div>

  <div class="upload-section">
    <!-- File Upload -->
    <div class="file-input-wrapper">
      <input 
        type="file" 
        id="audioFile" 
        (change)="onFileSelected($event)" 
        accept="audio/*,video/*" 
        [disabled]="isLoading || isRecording"
      />
      <label for="audioFile" class="file-label">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        <span>{{ selectedFile ? selectedFile.name : 'Choose Audio/Video File' }}</span>
      </label>
    </div>

    <!-- Live Recording -->
    <div class="recording-section">
      <div class="recording-controls">
        <button 
          *ngIf="!isRecording"
          class="btn btn-record" 
          (click)="startRecording()"
          [disabled]="isLoading"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <circle cx="12" cy="12" r="10"></circle>
          </svg>
          Start Recording
        </button>
        
        <button 
          *ngIf="isRecording"
          class="btn btn-stop" 
          (click)="stopRecording()"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <rect x="6" y="6" width="12" height="12" rx="2"></rect>
          </svg>
          Stop Recording
          <span class="recording-time">{{ formatTime(recordingTime) }}</span>
        </button>
      </div>
      <div *ngIf="isRecording" class="recording-indicator">
        <span class="pulse"></span>
        <span>Recording in progress...</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="button-group">
      <button 
        class="btn btn-primary" 
        (click)="upload()" 
        [disabled]="!selectedFile || isLoading || isRecording"
      >
        <span *ngIf="!isLoading">Check Order Status</span>
        <span *ngIf="isLoading">
          <span class="spinner"></span>
          Processing...
        </span>
      </button>
      
      <button 
        class="btn btn-secondary" 
        (click)="reset()" 
        [disabled]="isLoading || isRecording"
      >
        Reset
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <span>{{ error }}</span>
  </div>

  <!-- Results Section -->
  <div *ngIf="result && !error" class="results-section">
    <!-- Transcript -->
    <div class="result-card">
      <div class="card-header">
        <h2>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"></path>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
          </svg>
          Transcript
        </h2>
      </div>
      <div class="card-content">
        <textarea class="transcript-text" readonly>{{ result.transcript }}</textarea>
      </div>
    </div>

    <!-- Extracted Details -->
    <div class="result-card">
      <div class="card-header">
        <h2>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="8.5" cy="7" r="4"></circle>
            <path d="M20 8v6M23 11h-6"></path>
          </svg>
          Extracted Details
        </h2>
      </div>
      <div class="card-content">
        <div class="details-grid">
          <div class="detail-item">
            <span class="detail-label">Mobile Number:</span>
            <span class="detail-value">{{ result.mobile_number || 'Not found' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Order ID:</span>
            <span class="detail-value">{{ result.order_id || 'Not found' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Customer Name:</span>
            <span class="detail-value">{{ result.customer_name || 'Not found' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Topic:</span>
            <span class="detail-value">{{ result.topic || 'N/A' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Intent:</span>
            <span class="detail-value">{{ result.intent || 'N/A' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Status -->
    <div class="result-card" *ngIf="result.order_status">
      <div class="card-header">
        <h2>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
          </svg>
          Order Status
          <span class="status-found-badge" [class.found]="result.status_found" [class.not-found]="!result.status_found">
            {{ result.status_found ? 'Found' : 'Not Found' }}
          </span>
        </h2>
      </div>
      <div class="card-content">
        <div class="order-status-info">
          <div class="status-item">
            <span class="status-label">Status:</span>
            <span class="status-badge" [class.shipped]="result.order_status.status === 'Shipped'"
                  [class.delivered]="result.order_status.status === 'Delivered'"
                  [class.processing]="result.order_status.status === 'Processing'"
                  [class.out-for-delivery]="result.order_status.status === 'Out for Delivery'">
              {{ result.order_status.status }}
            </span>
          </div>
          <div class="status-item" *ngIf="result.order_status.delivery_date">
            <span class="status-label">Delivery Date:</span>
            <span class="status-value">{{ result.order_status.delivery_date }}</span>
          </div>
          <div class="status-item" *ngIf="result.order_status.last_update">
            <span class="status-label">Last Update:</span>
            <span class="status-value">{{ result.order_status.last_update }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Response Message -->
    <div class="result-card response-card">
      <div class="card-header">
        <h2>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          Response
        </h2>
      </div>
      <div class="card-content">
        <div class="response-text">
          <p class="screen-text">{{ result.response_text }}</p>
        </div>
        <div class="audio-controls" *ngIf="result.audio_url">
          <button 
            class="btn btn-audio" 
            (click)="isPlayingAudio ? stopAudio() : playAudio()"
          >
            <svg *ngIf="!isPlayingAudio" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <svg *ngIf="isPlayingAudio" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="6" y="4" width="4" height="16"></rect>
              <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
            {{ isPlayingAudio ? 'Stop Audio' : 'Play Audio Response' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
